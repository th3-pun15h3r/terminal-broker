{% extends 'base.html' %}
{% load static %}

{% block body %}

<form action="{% url 'signup' %}" method="POST">
{% csrf_token %}
<div class="mian-sign container mt-5 border rounded-3 border-secondary">
   <div class="container">
      <input type="hidden" name="id" value="{{pk}}">
      <div class="row pt-3 pb-3">
         <div class="col-md-12">
            <div class="row">
               <div class="col-md-1 pe-0">
                  <label class="align-middle pt-3 sing_name">Full Name:</label>
               </div>
               <div class="col-md-3 text-center">
                     {{form.full_name}}
               </div> 
               <div class="col-md-1 pe-0">
                  <label class="align-middle pt-3 sing_name">First Name:</label>
               </div>
               <div class="col-md-3 text-center">
                  {{form.first_name}}
               </div> 
               <div class="col-md-1 pe-0">
                  <label class="align-middle pt-3 sing_name">Last Name:</label>
               </div>
               <div class="col-md-3 text-center">
                  {{form.last_name}}
               </div>
               <div class="col-md-1">
                  <label class="align-middle pt-3 sing_name">BRN:</label>
               </div>
               <div class="col-md-3 text-center">
                  {{form.brn}}
               </div> 
               <div class="col-md-1">
                  <label class="align-middle pt-3 sing_name">ORN:</label>
               </div>
               <div class="col-md-3 text-center">
                  {{form.orn}}
               </div> 
               <div class="col-md-1">
                  <label class="align-middle pt-3 sing_name">Broker Email:</label>
               </div>
               <div class="col-md-3 text-center">
                  {{form.broker_email}}
               </div> 
               <div class="col-md-1">
                  <label class="align-middle pt-3 sing_name">Office Address:</label>
               </div>
               <div class="col-md-3 text-center">
                  {{form.office_address}}
               </div>
                <div class="col-md-1">
                  <label class="align-middle pt-3 sing_name">Office Email:</label>
               </div>
               <div class="col-md-3 text-center">
                  {{form.office_email}}
               </div> 
               <div class="col-md-1">
                  <label class="align-middle pt-3 sing_name">Contact Number:</label>
               </div>
               <div class="col-md-3 text-center">
                  {{form.contact_no}}
               </div>   
               <div class="col-md-1">
                  <label class="align-middle pt-3 sing_name">Description Lisc:</label>
               </div>
               <div class="col-md-3 text-center">
                  {{form.dec_lisc}}
               </div> 
               <div class="col-md-1">
                  <label class="align-middle pt-3 sing_name">Date of Issuance of Broker Card:</label>
               </div>
               <div class="col-md-3 text-center">
                  {{form.dateof_issuance_of_brokercard}}
               </div>
                 
               <div class="col-md-1">
                  <label class="align-middle pt-3 sing_name">Name of Establishment:</label>
               </div>
               <div class="col-md-3 text-center">
                  {{form.name_of_the_establishment}}
               </div>   
               
               <div class="col-md-1">
                  <label class="align-middle pt-3 sing_name">Agent Photo:</label>
               </div>
               <div class="col-md-3 text-center">
                  {% if form.instance.agent_photo %}
                  <div class="box-imag">
                     <img src="{{form.instance.agent_photo.url}}">
                  </div>
                  {% else %}
                  <div class="box-imag">
                     <img src="/static/img/logo.svg">
                  </div>
                  {% endif %}
               </div>
               <div class="col-md-1">
                  <label class="align-middle pt-3 sing_name">Company Logo:</label>
               </div>
               <div class="col-md-3 text-center">
                  {% if form.instance.company_logo %}
                  <div class="box-imag">
                     <img src="{{form.instance.company_logo.url}}">
                  </div>
                  {% else %}
                  <div class="box-imag">
                     <img src="/static/img/logo.svg">
                  </div>
                  {% endif %}
               </div> 
               
              <!--  <div class="col-md-2 text-center">
                  <button type="submit" id="edit" name="edit_signup" class="btn btn-dark px-5"> Edit </button>
               </div>  -->
               <div class="col-md-12 text-center mt-5 mb-3">
                  <!-- <button type="submit" id="save" name="next_email" class="btn btn-dark px-5" > Next </button> -->
                  <a href=""  class="Save"data-bs-toggle="modal" data-bs-target="#exampleModal">Save</a>
               </div>  
            </div>
         </div>
      </div>
   <!-- row 1 --> 
   <!-- row 13 -->
   </div>
   </div>
   </form>
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
<form id="modal_form" action="{% url 'edit_signup' pk=pk %}" method="POST">
{% csrf_token %}
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
      
         <div class="row">
            <div class="col-md-10">
               <div class="row form-group">
                  <div class="col-md-4 pe-0">
                     <label class="broker">Broker Email</label> 
                  </div>
                  <div class="col-md-8">
                     <input type="email" name="brokerEmail" class="form-control" id="brokerEmail" placeholder="Enter Broker Email">
                  </div>
               </div>
             </div>
             <div class="col-md-2">
               <div  class="main-wap">
                  <ul>
                  <span id="spin" class="spinner-border spinner-border-sm" style="display:none;" role="status" aria-hidden="true"></span>
                     <li id="exist" style="display:none;"><a href=""><i class="fas fa-check"></i></a></li>
                     <li id="not_exist" style="display:none;"><a href=""><i class="fas fa-times"></i></a></li>
                  </ul>
               </div>
             </div>
             <div class="col-md-10">
               <div class="row form-group">
                  <div class="col-md-4 pe-0">
                    <label class="broker">Otp</label>
                  </div>
                  <div class="col-md-8">
                    <input type="text" name="Otp" class="form-control" id="Otp" placeholder="Enter Otp" disabled>
                  </div>
               </div>
             </div>
             <div class="col-md-2">
               <div  class="main-wap">
               <input type="hidden" id="signup_id">
                  <ul>
                  <span id="otp_spin" class="spinner-border spinner-border-sm" style="display:none;" role="status" aria-hidden="true"></span>
                     <li id="valid_otp" style="display:none;"><a href=""><i class="fas fa-check"></i></a></li>
                     <li id="invalid_otp" style="display:none;"><a href=""><i class="fas fa-times"></i></a></li>
                  </ul>
               </div>
             </div>
             

             <div class="col-md-12 text-center">
               <div class="form-group">
               <button type="button" id="resend_otp_btn" name="resend_otp_btn" class="btn btn-danger btn-disabled mr-2" disabled>Resend Otp</button>
                 <button type="submit" id="modal_btn" name="modal_button" class="btn btn-dark btn-disabled" disabled>Save</button>
               </div>
             </div>

        </div>
      
      </div>
    </div>
  </div>
  </form>
</div>
<script src="{% static 'js/jquery.min.js' %}"></script>

<script>

$(document).ready(function(){

      $("#brokerEmail").change(function(){
         email = $(this).val()
         $("#spin").css('display','block')
         $.ajax({
            url:'/check_email/',
            type: 'get',
            data:{'email':email},
            success:function(res){
               if(res.status == 1){
                  $("#exist").css('display','block')
                  $("#not_exist").css('display','none')
                  $('#modal_btn').prop('disabled',false)
                  $("#modal_btn").removeClass('btn btn-disabled')
                  $("#spin").css('display','none')
                  $("#Otp").prop('disabled',false)
               } else{
                  $("#not_exist").css('display','block')
                  $("#exist").css('display','none')
                  $("#spin").css('display','none')
                  $("#Otp").prop('disabled',true)
                  
               }
            }
         
         })
         
         })


      $("#resend_otp_btn").click(function(){
         $("#Otp").val('')
         email =$("#brokerEmail").val()
         $.ajax({
            url:'/check_email/',
            type: 'get',
            data:{'email':email},
            success:function(res){

            }

            })
      })


         $("#Otp").keyup(function(){
            otp = $(this).val()
            if(otp.length != 0){
               $("#otp_spin").css('display','block')
            } else{
               $("#otp_spin").css('display','none')
            }
            if(otp.length == 4){
            $.ajax({
               url:'/check_otp/',
               type: 'get',
               data:{'otp': otp},
               success:function(res){
               if(res.status == 1){
                     $("#otp_spin").css('display','none')
                     $("#valid_otp").css('display','block')
                     $("#invalid_otp").css('display','none')
                     $("#resend_otp_btn").addClass('btn-disabled')
                     $('#resend_otp_btn').prop('disabled',true)
                     $("#modal_form").attr('action',"{% url 'edit_signup' pk=pk %}")
                     $("#signup_id").val(res.id)

                  }else {
                     $("#otp_spin").css('display','none')
                     $("#invalid_otp").css('display','block')
                     $("#valid_otp").css('display','none')
                     $("#resend_otp_btn").removeClass('btn-disabled')
                     $('#resend_otp_btn').prop('disabled',false)
                     $("#modal_form").attr('action',"{% url 'edit_signup' pk=pk %}")
               }
               }
            })
            } else {
               $("#valid_otp").css('display','none')
               $("#invalid_otp").css('display','none')
            }
         })
})
</script>


{% endblock body %}


